<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>parking.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>parking.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>&ldquo;<strong>Parking</strong>&rdquo; is a Python library for simulating the parking of vehicles along a single block face. After checking out the repository you can run this code as
    python parking.py <path_to_json_file></p>
<p>Simulation parameters are stored in json files. There are some samples in the <code>json/</code> folder.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">plotting</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Park a single car following a given <code>strategy</code>, an existing set of <code>parked_car_locs</code>, an <code>index</code> which represents between which cars we should park, and the bounds of the parking space <code>min_loc</code> and <code>max_loc</code>. Returns the updated <code>parked_car_locs</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">park_the_car</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;test_loc&quot;</span><span class="p">:</span>
        <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">)</span> <span class="c1"># just for testing, we are going to put a car right at `test_loc`.</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
        <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_loc</span> <span class="o">-</span> <span class="n">min_loc</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_loc</span><span class="p">)</span> <span class="c1"># put it somewhere random between `min_loc` and `max_loc`</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;middle&quot;</span><span class="p">:</span>
        <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">max_loc</span> <span class="o">+</span> <span class="n">min_loc</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="c1"># put it right in the middle</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;one_side&quot;</span><span class="p">:</span>
        <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">)</span> <span class="c1"># put it at `min_loc` always</span>
    <span class="k">elif</span> <span class="n">strategy</span> <span class="o">==</span> <span class="s2">&quot;half_half&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span> <span class="c1"># half of the time</span>
            <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">)</span> <span class="c1"># put it at `min_loc`</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span> <span class="c1"># put it at `max_loc`</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Strategy &quot;</span><span class="si">{</span><span class="n">strategy</span><span class="si">}</span><span class="s1">&quot; is undefined&#39;</span><span class="p">)</span> <span class="c1"># you made a typo</span>
    <span class="k">return</span> <span class="n">parked_car_locs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Pull another random vehicle length out of the vehicle length distribution defined by <code>mean_car_length</code>, <code>sigma_car_length</code> and optionally if there are motorcycles, <code>motorcycle_ratio</code> and <code>motorcycle_length</code></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">generate_new_car_length</span><span class="p">(</span><span class="n">params</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>return np.random.rand()*(max_car_length - min_car_length) + min_car_length # HALF CAR LENGTH</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="s2">&quot;motorcycles&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="c1"># if we are simulating motorcycles</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;motorcycle_ratio&quot;</span><span class="p">]:</span> <span class="c1"># if this vehicle is going to be a motorcycle (stochastic)</span>
            <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;motorcycle_length&quot;</span><span class="p">]</span> <span class="c1"># this is a motorcycle</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;mean_car_length&quot;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;sigma_car_length&quot;</span><span class="p">])</span> <span class="c1"># this is a car</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;mean_car_length&quot;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;sigma_car_length&quot;</span><span class="p">])</span> <span class="c1"># this is a car</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>For a given set of vehicle centres <code>parked_car_locs</code>, and their respective <code>parked_car_lengths</code>, block face length <code>L</code> and some <code>min_clearance</code> between the vehicles, return a list of all of the spaces between the vehicles.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_spot_lengths</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">min_clearance</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if no cars are parked yet</span>
        <span class="n">spots</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span><span class="p">]</span> <span class="c1"># return the full block face less the clearances at the ends</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># if there is just one car</span>
        <span class="n">spots</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span><span class="p">,</span>
            <span class="n">L</span> <span class="o">-</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="c1"># convert to a numpy array</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parked_car_lengths</span><span class="p">)</span> <span class="c1"># convert to a numpy array</span>
        <span class="n">spots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span><span class="p">,</span> <span class="c1"># the very first spot</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">l</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span><span class="p">,</span> <span class="c1"># the spaces between all of the parked cars</span>
                <span class="n">L</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span><span class="p">,</span> <span class="c1"># the empty space at the end</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">spots</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>For a given spot at position <code>index</code>, and a set of cars located at <code>parked_car_locs</code> with lengths <code>parked_car_lengths</code>, and clearances between them <code>min_clearance</code>, for a block face of length L, return the extremeties at which a new car could park in this spot if it has a length <code>new_car_length</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">get_spot_bounds</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">min_clearance</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># no cars yet</span>
        <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
        <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># just one car</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span> <span class="o">+</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># more than one car parked</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if this is the first spot</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">):</span> <span class="c1"># if this is the last spot</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span>
                <span class="o">+</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># if this is one of the interior spots</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span>
                <span class="o">+</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">min_clearance</span>
                <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>This function is not used for anything.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># no cars yet</span>
        <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
        <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
        <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="p">[</span><span class="n">new_car_length</span><span class="p">],</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># just one car</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">test_loc</span> <span class="o">-</span> <span class="n">new_car_length</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">test_loc</span> <span class="o">+</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span> <span class="o">&lt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">test_loc</span> <span class="o">-</span> <span class="n">new_car_length</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">&gt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">test_loc</span> <span class="o">+</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span> <span class="o">&lt;</span> <span class="n">L</span><span class="p">):</span>
            <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
            <span class="n">min_loc</span> <span class="o">=</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
            <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">test_loc</span> <span class="o">-</span> <span class="n">new_car_length</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">test_loc</span> <span class="o">+</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
                    <span class="o">&lt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
                    <span class="n">min_loc</span> <span class="o">=</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
                    <span class="n">max_loc</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">parked_car_locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
                    <span class="p">)</span>
                    <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">test_loc</span> <span class="o">-</span> <span class="n">new_car_length</span> <span class="o">-</span> <span class="n">min_clearance</span>
                    <span class="o">&gt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">test_loc</span> <span class="o">+</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span> <span class="o">&lt;</span> <span class="n">L</span><span class="p">):</span>
                    <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
                    <span class="n">min_loc</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">min_clearance</span>
                        <span class="o">+</span> <span class="n">new_car_length</span>
                    <span class="p">)</span>
                    <span class="n">max_loc</span> <span class="o">=</span> <span class="n">L</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
                    <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">test_loc</span> <span class="o">-</span> <span class="n">new_car_length</span> <span class="o">-</span> <span class="n">min_clearance</span>
                    <span class="o">&gt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">test_loc</span> <span class="o">+</span> <span class="n">new_car_length</span> <span class="o">+</span> <span class="n">min_clearance</span>
                    <span class="o">&lt;</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
                    <span class="n">min_loc</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">min_clearance</span>
                        <span class="o">+</span> <span class="n">new_car_length</span>
                    <span class="p">)</span>
                    <span class="n">max_loc</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">parked_car_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_clearance</span> <span class="o">-</span> <span class="n">new_car_length</span>
                    <span class="p">)</span>
                    <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">test_loc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">True</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>if nothing else worked</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="kc">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">time_march</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parked_car_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">linear_densities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">car_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_car_length</span> <span class="o">=</span> <span class="n">generate_new_car_length</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">found_spot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">])</span>

    <span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;departures_per_metre&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>  <span class="c1"># remove one car every timestep</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>just remove one car</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parked_car_locs</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;spatiotemporal&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">car_ids</span><span class="p">)):</span>  <span class="c1"># omg this is going to be so slow</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;t_f&quot;</span> <span class="ow">in</span> <span class="n">car_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">car_ids</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">to_remove</span><span class="p">]:</span>
                            <span class="n">car_ids</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;t_f&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>print(i)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                            <span class="k">break</span>
            <span class="n">parked_car_locs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span>
            <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Brute force filling method
for i in range(1000): # aggressively try to fill every spot
    test_loc = L*np.random.rand()
    parked_car_locs,parked_car_lengths,found_spot =  is_empty(parked_car_locs,
                                                              parked_car_lengths,
                                                              new_car_length,
                                                              test_loc)
    if found_spot:
        new_car_length = generate_new_car_length() # another car arrives looking to park
        found_spot = False</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>Criteria-based filling method</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">fits</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">fits</span><span class="p">:</span>
            <span class="n">spot_lengths</span> <span class="o">=</span> <span class="n">get_spot_lengths</span><span class="p">(</span>
                <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;min_clearance&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">avail_spots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spot_lengths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">new_car_length</span>
            <span class="n">num_avail_spots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">avail_spots</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_avail_spots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fits</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avail_spot_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">avail_spots</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">avail_spot_indices</span><span class="p">)</span>
                <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span> <span class="o">=</span> <span class="n">get_spot_bounds</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span>
                    <span class="n">parked_car_locs</span><span class="p">,</span>
                    <span class="n">parked_car_lengths</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;min_clearance&quot;</span><span class="p">],</span>
                    <span class="n">new_car_length</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">],</span>
                <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>print(max_loc-min_loc,spot_lengths[i],new_car_length)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">parked_car_locs</span> <span class="o">=</span> <span class="n">park_the_car</span><span class="p">(</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;strategy&quot;</span><span class="p">],</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">min_loc</span><span class="p">,</span> <span class="n">max_loc</span>
                <span class="p">)</span>
                <span class="n">parked_car_lengths</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">new_car_length</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;spatiotemporal&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="n">car_ids</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
                    <span class="n">car_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="n">parked_car_locs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="n">new_car_length</span><span class="p">,</span> <span class="s2">&quot;t_i&quot;</span><span class="p">:</span> <span class="n">t</span><span class="p">}</span>
                <span class="n">new_car_length</span> <span class="o">=</span> <span class="n">generate_new_car_length</span><span class="p">(</span>
                    <span class="n">params</span>
                <span class="p">)</span>  <span class="c1"># another car arrives looking to park -- cars never give up, if they dont make it in this round they will persist to next round</span>
        <span class="n">linear_densities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">parked_car_lengths</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
                <span class="n">t</span><span class="p">,</span>
                <span class="n">nt</span><span class="p">,</span>
                <span class="n">parked_car_locs</span><span class="p">,</span>
                <span class="n">parked_car_lengths</span><span class="p">,</span>
                <span class="n">spot_lengths</span><span class="p">,</span>
                <span class="n">linear_densities</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_graph</span><span class="p">(</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">spot_lengths</span><span class="p">,</span> <span class="n">linear_densities</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/summary.png&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;spatiotemporal&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">spatiotemporal</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">car_ids</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/spatiotemporal.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/spatiotemporal.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/linear_density_</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.npy&#39;</span><span class="p">,</span> <span class="n">linear_densities</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/gaps_</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.npy&#39;</span><span class="p">,</span> <span class="n">spot_lengths</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;outfolder&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/cars_</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.npy&#39;</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parked_car_locs</span><span class="p">,</span> <span class="n">parked_car_lengths</span><span class="p">,</span> <span class="n">spot_lengths</span><span class="p">,</span> <span class="n">linear_densities</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>verbose = True
verbose = False
L = 1e4 # length of road (m)
nt = 1e5
mean_car_length = 2.5 # length of HALF OF the average car (m)
sigma_car_length = 1./3. # width of distribution of HALF OF car size (m)
min_clearance = 0. # gap between cars at EACH END (m)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>strategy = &lsquo;test_loc&rsquo;
strategy = &lsquo;random&rsquo;
strategy = &lsquo;middle&rsquo;
strategy = &lsquo;one_side&rsquo;</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">json_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>strategy = sys.argv[1]
outfolder = sys.argv[2]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;strategy&quot;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;strategy&quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;strategy&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">mean_car_length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;mean_car_length&quot;</span><span class="p">],</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                    <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;mean_car_length&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">sigma_car_length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="n">tqdm</span><span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sigma_car_length&quot;</span><span class="p">],</span>
                        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
                        <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;sigma_car_length&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;ergodic&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">L</span><span class="p">)),</span>
                        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;ergodic&quot;</span><span class="p">,</span>
                        <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">disable</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="p">):</span>  <span class="c1"># rerun the same simulation this many times so that they all have the same equivalent length</span>
                        <span class="n">temp_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">temp_params</span><span class="p">[</span><span class="s2">&quot;strategy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
                        <span class="n">temp_params</span><span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
                        <span class="n">temp_params</span><span class="p">[</span><span class="s2">&quot;mean_car_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_car_length</span>
                        <span class="n">temp_params</span><span class="p">[</span><span class="s2">&quot;sigma_car_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_car_length</span>
                        <span class="n">temp_params</span><span class="p">[</span><span class="s2">&quot;ergodic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                        <span class="n">temp_params</span><span class="p">[</span>
                            <span class="s2">&quot;outfolder&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;output/strategy_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">/L_</span><span class="si">{</span><span class="n">L</span><span class="si">}</span><span class="s2">/mean_car_length_</span><span class="si">{</span><span class="n">mean_car_length</span><span class="si">}</span><span class="s2">/sigma_car_length_</span><span class="si">{</span><span class="n">sigma_car_length</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="s2">&quot;motorcycles&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                            <span class="n">base_folder</span> <span class="o">=</span> <span class="n">temp_params</span><span class="p">[</span><span class="s1">&#39;outfolder&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">:]</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motorcycle_ratio&#39;</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;motorcycle_ratio&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                                <span class="n">temp_params</span><span class="p">[</span><span class="s1">&#39;motorcycle_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
                                <span class="n">temp_params</span><span class="p">[</span>
                                    <span class="s2">&quot;outfolder&quot;</span>
                                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;output/motorcycles/motorcycle_ratio_</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">base_folder</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">(</span>
                                    <span class="n">parked_car_locs</span><span class="p">,</span>
                                    <span class="n">parked_car_lengths</span><span class="p">,</span>
                                    <span class="n">spot_lengths</span><span class="p">,</span>
                                    <span class="n">linear_densities</span><span class="p">,</span>
                                <span class="p">)</span> <span class="o">=</span> <span class="n">time_march</span><span class="p">(</span><span class="n">temp_params</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="p">(</span>
                                <span class="n">parked_car_locs</span><span class="p">,</span>
                                <span class="n">parked_car_lengths</span><span class="p">,</span>
                                <span class="n">spot_lengths</span><span class="p">,</span>
                                <span class="n">linear_densities</span><span class="p">,</span>
                            <span class="p">)</span> <span class="o">=</span> <span class="n">time_march</span><span class="p">(</span><span class="n">temp_params</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
